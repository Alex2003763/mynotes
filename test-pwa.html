<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PWA æ¸¬è©¦é é¢</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f8fafc;
    }
    .test-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 10px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    .success { background: #dcfce7; color: #15803d; }
    .error { background: #fecaca; color: #dc2626; }
    .warning { background: #fef3c7; color: #d97706; }
    .info { background: #dbeafe; color: #2563eb; }
    button {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 4px;
    }
    button:hover {
      background: #4338ca;
    }
    pre {
      background: #f1f5f9;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“± MyNotes PWA æ¸¬è©¦å·¥å…·</h1>
  
  <div class="test-card">
    <h3>ğŸ”§ åŸºæœ¬ PWA åŠŸèƒ½æª¢æ¸¬</h3>
    <p>Service Worker æ”¯æ´: <span id="sw-support" class="status">æª¢æ¸¬ä¸­...</span></p>
    <p>Manifest æ”¯æ´: <span id="manifest-support" class="status">æª¢æ¸¬ä¸­...</span></p>
    <p>ç›®å‰ç¶²è·¯ç‹€æ…‹: <span id="online-status" class="status">æª¢æ¸¬ä¸­...</span></p>
    <p>å®‰è£ç‹€æ…‹: <span id="install-status" class="status">æª¢æ¸¬ä¸­...</span></p>
  </div>

  <div class="test-card">
    <h3>ğŸ“± iOS ç‰¹å®šåŠŸèƒ½æª¢æ¸¬</h3>
    <p>iOS è£ç½®: <span id="ios-device" class="status">æª¢æ¸¬ä¸­...</span></p>
    <p>ç¨ç«‹æ¨¡å¼ (PWA): <span id="standalone-mode" class="status">æª¢æ¸¬ä¸­...</span></p>
    <p>Safari ç‰ˆæœ¬: <span id="safari-version" class="status">æª¢æ¸¬ä¸­...</span></p>
  </div>

  <div class="test-card">
    <h3>ğŸš€ æ“ä½œæ¸¬è©¦</h3>
    <button onclick="testServiceWorker()">æ¸¬è©¦ Service Worker</button>
    <button onclick="testCache()">æ¸¬è©¦å¿«å–</button>
    <button onclick="testOffline()">æ¨¡æ“¬é›¢ç·š</button>
    <button onclick="showInstallPrompt()">é¡¯ç¤ºå®‰è£æç¤º</button>
    <div id="test-results"></div>
  </div>

  <div class="test-card">
    <h3>ğŸ“‹ è¨ºæ–·è³‡è¨Š</h3>
    <pre id="diagnostic-info">è¼‰å…¥ä¸­...</pre>
  </div>

  <script>
    // åŸºæœ¬æª¢æ¸¬
    function runBasicTests() {
      // Service Worker æ”¯æ´
      const swSupport = document.getElementById('sw-support');
      if ('serviceWorker' in navigator) {
        swSupport.textContent = 'âœ… æ”¯æ´';
        swSupport.className = 'status success';
      } else {
        swSupport.textContent = 'âŒ ä¸æ”¯æ´';
        swSupport.className = 'status error';
      }

      // Manifest æ”¯æ´
      const manifestSupport = document.getElementById('manifest-support');
      if ('manifestchange' in window || 'BeforeInstallPromptEvent' in window) {
        manifestSupport.textContent = 'âœ… æ”¯æ´';
        manifestSupport.className = 'status success';
      } else {
        manifestSupport.textContent = 'âš ï¸ éƒ¨åˆ†æ”¯æ´';
        manifestSupport.className = 'status warning';
      }

      // ç¶²è·¯ç‹€æ…‹
      const onlineStatus = document.getElementById('online-status');
      if (navigator.onLine) {
        onlineStatus.textContent = 'ğŸŒ ç·šä¸Š';
        onlineStatus.className = 'status success';
      } else {
        onlineStatus.textContent = 'ğŸ“´ é›¢ç·š';
        onlineStatus.className = 'status warning';
      }

      // å®‰è£ç‹€æ…‹
      const installStatus = document.getElementById('install-status');
      if (window.matchMedia('(display-mode: standalone)').matches) {
        installStatus.textContent = 'âœ… å·²å®‰è£';
        installStatus.className = 'status success';
      } else {
        installStatus.textContent = 'ğŸ“± ç€è¦½å™¨æ¨¡å¼';
        installStatus.className = 'status info';
      }
    }

    // iOS æª¢æ¸¬
    function runIOSTests() {
      const iosDevice = document.getElementById('ios-device');
      const standaloneMode = document.getElementById('standalone-mode');
      const safariVersion = document.getElementById('safari-version');

      // iOS è£ç½®æª¢æ¸¬
      const isIOS = /iP(ad|hone|od)/.test(navigator.userAgent);
      if (isIOS) {
        iosDevice.textContent = 'ğŸ iOS è£ç½®';
        iosDevice.className = 'status success';
      } else {
        iosDevice.textContent = 'ğŸ¤– é iOS è£ç½®';
        iosDevice.className = 'status info';
      }

      // ç¨ç«‹æ¨¡å¼æª¢æ¸¬
      if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
        standaloneMode.textContent = 'âœ… PWA æ¨¡å¼';
        standaloneMode.className = 'status success';
      } else {
        standaloneMode.textContent = 'ğŸŒ ç€è¦½å™¨æ¨¡å¼';
        standaloneMode.className = 'status info';
      }

      // Safari ç‰ˆæœ¬æª¢æ¸¬
      if (isIOS) {
        const match = navigator.userAgent.match(/Version\/(\d+(\.\d+)?)/);
        if (match) {
          const version = parseFloat(match[1]);
          if (version >= 11.3) {
            safariVersion.textContent = `âœ… Safari ${match[1]}`;
            safariVersion.className = 'status success';
          } else {
            safariVersion.textContent = `âš ï¸ Safari ${match[1]} (èˆŠç‰ˆ)`;
            safariVersion.className = 'status warning';
          }
        } else {
          safariVersion.textContent = 'â“ ç„¡æ³•æª¢æ¸¬';
          safariVersion.className = 'status warning';
        }
      } else {
        safariVersion.textContent = 'â– é Safari';
        safariVersion.className = 'status info';
      }
    }

    // æ“ä½œæ¸¬è©¦å‡½æ•¸
    function testServiceWorker() {
      const results = document.getElementById('test-results');
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistration().then(registration => {
          if (registration) {
            results.innerHTML = '<div class="status success">âœ… Service Worker å·²è¨»å†Š: ' + registration.scope + '</div>';
          } else {
            results.innerHTML = '<div class="status warning">âš ï¸ Service Worker æœªè¨»å†Š</div>';
          }
        });
      } else {
        results.innerHTML = '<div class="status error">âŒ ä¸æ”¯æ´ Service Worker</div>';
      }
    }

    function testCache() {
      const results = document.getElementById('test-results');
      if ('caches' in window) {
        caches.keys().then(cacheNames => {
          results.innerHTML = '<div class="status success">âœ… å¿«å–å¯ç”¨ï¼Œå¿«å–æ•¸é‡: ' + cacheNames.length + '</div>';
        });
      } else {
        results.innerHTML = '<div class="status error">âŒ ä¸æ”¯æ´ Cache API</div>';
      }
    }

    function testOffline() {
      const results = document.getElementById('test-results');
      results.innerHTML = '<div class="status info">â„¹ï¸ è«‹æ‰‹å‹•é—œé–‰ç¶²è·¯é€£æ¥ä¾†æ¸¬è©¦é›¢ç·šåŠŸèƒ½</div>';
    }

    function showInstallPrompt() {
      const results = document.getElementById('test-results');
      if (/iP(ad|hone|od)/.test(navigator.userAgent)) {
        results.innerHTML = '<div class="status info">â„¹ï¸ iOS è£ç½®è«‹ä½¿ç”¨ Safari çš„ã€ŒåŠ å…¥ä¸»ç•«é¢ã€åŠŸèƒ½</div>';
      } else {
        results.innerHTML = '<div class="status info">â„¹ï¸ è«‹æŸ¥çœ‹ç€è¦½å™¨åœ°å€æ¬„çš„å®‰è£åœ–ç¤º</div>';
      }
    }

    // è¨ºæ–·è³‡è¨Š
    function generateDiagnosticInfo() {
      const info = {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        cookieEnabled: navigator.cookieEnabled,
        onLine: navigator.onLine,
        hardwareConcurrency: navigator.hardwareConcurrency,
        maxTouchPoints: navigator.maxTouchPoints,
        viewport: {
          width: window.innerWidth,
          height: window.innerHeight,
          devicePixelRatio: window.devicePixelRatio
        },
        location: {
          protocol: location.protocol,
          host: location.host,
          pathname: location.pathname
        },
        support: {
          serviceWorker: 'serviceWorker' in navigator,
          caches: 'caches' in window,
          indexedDB: 'indexedDB' in window,
          localStorage: 'localStorage' in window,
          sessionStorage: 'sessionStorage' in window,
          geolocation: 'geolocation' in navigator,
          pushNotification: 'PushManager' in window,
          backgroundSync: 'serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype
        }
      };

      document.getElementById('diagnostic-info').textContent = JSON.stringify(info, null, 2);
    }

    // ç›£è½ç¶²è·¯ç‹€æ…‹è®ŠåŒ–
    window.addEventListener('online', runBasicTests);
    window.addEventListener('offline', runBasicTests);

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      runBasicTests();
      runIOSTests();
      generateDiagnosticInfo();
    });
  </script>
</body>
</html>